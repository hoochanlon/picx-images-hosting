<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>éƒ¨ç½²æ•™ç¨‹ - picx-images-hosting</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hoochanlon/fonts@refs/heads/main/public/OPPOSans4/result.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./css/global.css" />
  <link rel="stylesheet" href="./css/tutorial.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
</head>
<body class="tutorial-page">
  <div class="tutorial-container">
    <aside class="tutorial-sidebar">
      <div class="tutorial-sidebar-header">
        <h2>ğŸ“š å›¾åºŠéƒ¨ç½²æ•™ç¨‹</h2>
      </div>
      <nav class="tutorial-sidebar-nav" id="tutorial-sidebar-nav">
        <!-- å°†ä» front-matter åŠ¨æ€ç”Ÿæˆ -->
      </nav>
      <div class="tutorial-sidebar-content" id="tutorial-sidebar-content">
        <!-- Markdown å†…å®¹å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
      </div>
      <div class="tutorial-sidebar-footer">
        <a href="index.html">
          <i class="fas fa-arrow-left"></i>
          <span>è¿”å›é¦–é¡µ</span>
        </a>
      </div>
    </aside>

    <!-- ç§»åŠ¨ç«¯é®ç½©å±‚ -->
    <div class="tutorial-sidebar-overlay" id="sidebar-overlay"></div>

    <main class="tutorial-main">
      <button class="tutorial-mobile-menu-toggle" id="mobile-menu-toggle" aria-label="åˆ‡æ¢èœå•">
        <i class="fas fa-bars"></i>
      </button>
      <div class="tutorial-header">
        <div class="tutorial-header-inner">
          <div class="tutorial-steps" id="tutorial-steps">
            <!-- å°†ä» front-matter åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>

      <div class="tutorial-content-wrapper">
        <div class="tutorial-content" id="tutorial-content">
          <!-- æ­¥éª¤å†…å®¹å°†ä»é…ç½®æ–‡ä»¶åŠ¨æ€ç”Ÿæˆ -->
          <div class="tutorial-loading">æ­£åœ¨åŠ è½½é…ç½®...</div>
        </div>
        
        <!-- å³ä¾§ç›®å½•å¯¼èˆª -->
        <aside class="tutorial-toc" id="tutorial-toc">
          <div class="tutorial-toc-header">
            <h3>ç›®å½•</h3>
          </div>
          <nav class="tutorial-toc-nav" id="tutorial-toc-nav">
            <div class="tutorial-toc-loading">æ­£åœ¨ç”Ÿæˆç›®å½•...</div>
          </nav>
        </aside>
      </div>
    </main>
    
    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button class="tutorial-back-to-top" id="back-to-top" aria-label="å›åˆ°é¡¶éƒ¨">
      <i class="fas fa-arrow-up"></i>
    </button>
  </div>

  <script>
    let currentStep = 0;
    let totalSteps = 0;
    let tutorialConfig = null;
    let markdownFiles = [];
    
    // å­˜å‚¨æ­¥éª¤ä¿¡æ¯
    const stepMetadata = [];

    let stepContents = [];
    let stepIndicators = [];
    let sidebarItems = [];
    // prevBtn å’Œ nextBtn æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸èƒ½åœ¨è¿™é‡Œè·å–
    const sidebarNav = document.getElementById('tutorial-sidebar-nav');
    const stepsContainer = document.getElementById('tutorial-steps');
    const tutorialContent = document.getElementById('tutorial-content');

    // åŠ è½½é…ç½®æ–‡ä»¶
    async function loadTutorialConfig() {
      try {
        console.log('å¼€å§‹åŠ è½½é…ç½®æ–‡ä»¶: docs/tutorial-config.json');
        const response = await fetch('docs/tutorial-config.json');
        console.log('é…ç½®æ–‡ä»¶å“åº”çŠ¶æ€:', response.status, response.statusText);
        
        if (!response.ok) {
          throw new Error(`Failed to load config: ${response.status} ${response.statusText}`);
        }
        
        tutorialConfig = await response.json();
        console.log('é…ç½®æ–‡ä»¶è§£ææˆåŠŸ:', tutorialConfig);
        
        // æŒ‰ order æ’åºæ­¥éª¤
        tutorialConfig.steps.sort((a, b) => (a.order || 0) - (b.order || 0));
        
        // æå–æ–‡ä»¶è·¯å¾„
        markdownFiles = tutorialConfig.steps.map(step => step.file);
        console.log('Markdown æ–‡ä»¶åˆ—è¡¨:', markdownFiles);
        
        // åˆå§‹åŒ–æ­¥éª¤å…ƒæ•°æ®
        tutorialConfig.steps.forEach((step, index) => {
          stepMetadata[index] = {
            title: step.title || `æ­¥éª¤ ${index + 1}`,
            shortTitle: step.shortTitle || step.title || `æ­¥éª¤ ${index + 1}`,
            icon: step.icon || 'fa-circle',
            order: step.order || index + 1
          };
        });
        
        // ç¡®ä¿ stepMetadata æ•°ç»„è¿ç»­
        const sortedMetadata = [];
        for (let i = 0; i < tutorialConfig.steps.length; i++) {
          sortedMetadata[i] = stepMetadata[i] || stepMetadata.find(m => m && m.order === i + 1);
        }
        stepMetadata.length = 0;
        stepMetadata.push(...sortedMetadata);
        
        totalSteps = tutorialConfig.steps.length;
        console.log('æ­¥éª¤å…ƒæ•°æ®åˆå§‹åŒ–å®Œæˆï¼Œæ€»æ•°:', totalSteps, stepMetadata);
        
        // ç”Ÿæˆæ­¥éª¤å†…å®¹åŒºåŸŸ
        if (tutorialContent) {
          generateStepContentAreas();
        } else {
          console.error('tutorialContent æœªæ‰¾åˆ°ï¼Œæ— æ³•ç”Ÿæˆæ­¥éª¤å†…å®¹åŒºåŸŸ');
        }
        
        return tutorialConfig;
      } catch (error) {
        console.error('Error loading tutorial config:', error);
        if (tutorialContent) {
          tutorialContent.innerHTML = `<div class="tutorial-header"><h1>picx-images-hosting éƒ¨ç½²æ•™ç¨‹</h1></div><p>åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥ï¼š${error.message}</p><p>è¯·æ£€æŸ¥ docs/tutorial-config.json æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</p><p>è¯¦ç»†é”™è¯¯ä¿¡æ¯è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ã€‚</p>`;
        }
        return null;
      }
    }

    // åŠ¨æ€ç”Ÿæˆæ­¥éª¤å†…å®¹åŒºåŸŸ
    function generateStepContentAreas() {
      if (!tutorialContent) {
        console.error('tutorialContent æœªæ‰¾åˆ°');
        return;
      }
      
      if (!tutorialConfig || !tutorialConfig.steps) {
        console.error('tutorialConfig æˆ– steps æœªå®šä¹‰');
        return;
      }
      
      console.log('å¼€å§‹ç”Ÿæˆæ­¥éª¤å†…å®¹åŒºåŸŸï¼Œæ­¥éª¤æ•°é‡:', tutorialConfig.steps.length);
      
      // ä¿å­˜æ ‡é¢˜å’ŒæŒ‰é’®åŒºåŸŸ
      const headerDiv = tutorialContent.querySelector('.tutorial-header');
      const headerHTML = headerDiv ? headerDiv.outerHTML : '';
      const actionsDiv = tutorialContent.querySelector('.tutorial-actions');
      const actionsHTML = actionsDiv ? actionsDiv.outerHTML : '';
      
      // æ¸…ç©ºå†…å®¹åŒºåŸŸï¼ˆä½†ä¿ç•™æ ‡é¢˜ï¼‰
      const loadingDiv = tutorialContent.querySelector('.tutorial-loading');
      if (loadingDiv) {
        loadingDiv.remove();
      }
      
      // å¦‚æœæ­¥éª¤å†…å®¹åŒºåŸŸä¸å­˜åœ¨ï¼Œç”Ÿæˆå®ƒä»¬
      if (tutorialContent.querySelectorAll('.tutorial-step-content').length === 0) {
        tutorialConfig.steps.forEach((step, index) => {
          const contentDiv = document.createElement('div');
          contentDiv.className = `tutorial-step-content ${index === 0 ? 'active' : ''}`;
          contentDiv.dataset.step = index;
          contentDiv.innerHTML = '<div class="tutorial-loading">æ­£åœ¨åŠ è½½å†…å®¹...</div>';
          tutorialContent.appendChild(contentDiv);
        });
        console.log('å·²ç”Ÿæˆ', tutorialConfig.steps.length, 'ä¸ªæ­¥éª¤å†…å®¹åŒºåŸŸ');
      }
      
      // ç¡®ä¿æ ‡é¢˜å­˜åœ¨
      if (!headerDiv && headerHTML) {
        tutorialContent.insertAdjacentHTML('afterbegin', headerHTML);
      }
      
      // ç¡®ä¿æŒ‰é’®åŒºåŸŸå­˜åœ¨ï¼Œå¹¶æ”¾åœ¨æ‰€æœ‰å†…å®¹ä¹‹å
      if (!actionsDiv) {
        if (actionsHTML) {
          tutorialContent.insertAdjacentHTML('beforeend', actionsHTML);
        } else {
          const newActionsDiv = document.createElement('div');
          newActionsDiv.className = 'tutorial-actions';
          newActionsDiv.innerHTML = `
            <button class="tutorial-btn tutorial-btn-secondary" id="prev-btn" disabled>
              <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
            </button>
            <button class="tutorial-btn tutorial-btn-primary" id="next-btn">
              ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
            </button>
          `;
          tutorialContent.appendChild(newActionsDiv);
        }
      } else {
        // å¦‚æœæŒ‰é’®å·²å­˜åœ¨ï¼Œç¡®ä¿å®ƒåœ¨æœ€å
        tutorialContent.appendChild(actionsDiv);
      }
      
      // é‡æ–°è·å–å…ƒç´ å¼•ç”¨
      stepContents = document.querySelectorAll('.tutorial-step-content');
      console.log('æ­¥éª¤å†…å®¹åŒºåŸŸç”Ÿæˆå®Œæˆï¼Œæ‰¾åˆ°', stepContents.length, 'ä¸ªåŒºåŸŸ');
      
      // ç»‘å®šæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
      bindButtonEvents();
    }
    
    // ç»‘å®šæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨ï¼ˆæŒ‰é’®æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œéœ€è¦å»¶è¿Ÿç»‘å®šï¼‰
    function bindButtonEvents() {
      const prevBtnElement = document.getElementById('prev-btn');
      const nextBtnElement = document.getElementById('next-btn');
      
      if (prevBtnElement) {
        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé€šè¿‡å…‹éš†èŠ‚ç‚¹ï¼‰
        const newPrevBtn = prevBtnElement.cloneNode(true);
        prevBtnElement.parentNode.replaceChild(newPrevBtn, prevBtnElement);
        newPrevBtn.addEventListener('click', () => {
          if (currentStep > 0) {
            updateStep(currentStep - 1);
          }
        });
      }

      if (nextBtnElement) {
        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé€šè¿‡å…‹éš†èŠ‚ç‚¹ï¼‰
        const newNextBtn = nextBtnElement.cloneNode(true);
        nextBtnElement.parentNode.replaceChild(newNextBtn, nextBtnElement);
        newNextBtn.addEventListener('click', () => {
          if (currentStep < totalSteps - 1) {
            updateStep(currentStep + 1);
          } else {
            // å®Œæˆæ•™ç¨‹ï¼Œè¿”å›é¦–é¡µ
            window.location.href = 'index.html';
          }
        });
      }
    }

    // è§£æ front-matter
    function parseFrontMatter(text) {
      const frontMatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
      const match = text.match(frontMatterRegex);
      
      if (!match) {
        return { metadata: null, content: text };
      }
      
      const metadataText = match[1];
      const content = match[2];
      const metadata = {};
      
      metadataText.split('\n').forEach(line => {
        const colonIndex = line.indexOf(':');
        if (colonIndex > 0) {
          const key = line.substring(0, colonIndex).trim();
          let value = line.substring(colonIndex + 1).trim();
          // ç§»é™¤å¼•å·
          if ((value.startsWith('"') && value.endsWith('"')) || 
              (value.startsWith("'") && value.endsWith("'"))) {
            value = value.slice(1, -1);
          }
          metadata[key] = value;
        }
      });
      
      return { metadata, content };
    }

    // ç”Ÿæˆæ­¥éª¤ç¼–å·ï¼ˆé˜¿æ‹‰ä¼¯æ•°å­—ï¼‰
    function getStepNumber(order) {
      return order;
    }

    // åŠ¨æ€ç”Ÿæˆä¾§è¾¹æ å¯¼èˆª
    function generateSidebarNav() {
      if (!sidebarNav) return;
      
      sidebarNav.innerHTML = '';
      stepMetadata.forEach((meta, index) => {
        const item = document.createElement('div');
        item.className = `tutorial-sidebar-nav-item ${index === currentStep ? 'active' : ''}`;
        item.dataset.step = index;
        item.innerHTML = `
          <i class="fas ${meta.icon || 'fa-circle'}"></i>
          <span>${meta.shortTitle || meta.title || `æ­¥éª¤ ${index + 1}`}</span>
        `;
        sidebarNav.appendChild(item);
      });
      
      sidebarItems = document.querySelectorAll('.tutorial-sidebar-nav-item');
    }

    // åŠ¨æ€ç”Ÿæˆæ­¥éª¤æŒ‡ç¤ºå™¨
    function generateStepIndicators() {
      if (!stepsContainer) return;
      
      stepsContainer.innerHTML = '';
      stepMetadata.forEach((meta, index) => {
        const step = document.createElement('div');
        step.className = `tutorial-step ${index === currentStep ? 'active' : ''}`;
        step.dataset.step = index;
        step.innerHTML = `
          <span>${getStepNumber(meta.order || index + 1)}</span>
          <span>${meta.title || `æ­¥éª¤ ${index + 1}`}</span>
        `;
        stepsContainer.appendChild(step);
      });
      
      stepIndicators = document.querySelectorAll('.tutorial-step');
    }

    // é¢„å¤„ç† Docusaurus callout è¯­æ³•
    // æ”¯æŒæ ¼å¼: :::note æˆ– :::note Title
    function preprocessCallouts(text) {
      const lines = text.split('\n');
      const result = [];
      let i = 0;
      
      while (i < lines.length) {
        const line = lines[i];
        
        // æ£€æµ‹ Docusaurus callout å¼€å§‹: :::type æˆ– :::type Titleï¼ˆå¿…é¡»æ•´è¡ŒåŒ¹é…ï¼‰
        const trimmedLine = line.trim();
        const calloutStartMatch = trimmedLine.match(/^:::\s*([a-zA-Z]+)(?:\s+(.+))?$/);
        
        if (calloutStartMatch) {
          const calloutType = calloutStartMatch[1].trim().toLowerCase();
          const customTitle = calloutStartMatch[2] ? calloutStartMatch[2].trim() : '';
          
          // æ”¯æŒçš„ callout ç±»å‹ï¼ˆæ˜ å°„åˆ°ç°æœ‰æ ·å¼ï¼‰
          const supportedTypes = {
            'note': 'note',
            'tip': 'tip',
            'info': 'note',
            'important': 'important',
            'warning': 'warning',
            'danger': 'caution',
            'caution': 'caution'
          };
          
          if (supportedTypes.hasOwnProperty(calloutType)) {
            const mappedType = supportedTypes[calloutType];
            const contentLines = [];
            i++; // è·³è¿‡ callout å¼€å§‹è¡Œ
            
            // æ”¶é›†å†…å®¹ç›´åˆ°é‡åˆ° ::: ç»“æŸæ ‡è®°
            while (i < lines.length) {
              const contentLine = lines[i];
              const trimmedContentLine = contentLine.trim();
              
              // æ£€æµ‹ callout ç»“æŸ: :::ï¼ˆå¿…é¡»æ•´è¡ŒåŒ¹é…ï¼‰
              if (trimmedContentLine === ':::') {
                i++; // è·³è¿‡ç»“æŸæ ‡è®°
                break;
              }
              
              // æ”¶é›†å†…å®¹è¡Œï¼ˆåŒ…æ‹¬ç©ºè¡Œï¼‰
              contentLines.push(contentLine);
              i++;
            }
            
            // æ¸²æŸ“ callout
            const content = contentLines.join('\n').trim();
            if (content) {
              result.push(renderCallout(mappedType, content, customTitle));
            }
            
            // ç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œï¼ˆä¸æ·»åŠ å½“å‰è¡Œï¼Œå› ä¸ºå·²ç»å¤„ç†å®Œäº†ï¼‰
            continue;
          }
        }
        
        // ä¸æ˜¯ calloutï¼Œç›´æ¥æ·»åŠ åŸè¡Œ
        result.push(line);
        i++;
      }
      
      return result.join('\n');
    }
    
    // å­˜å‚¨ callout æ•°æ®ï¼Œç”¨äºåç»­æ¸²æŸ“
    const calloutStore = [];
    let calloutCounter = 0;
    
    // æ¸²æŸ“ callout HTMLï¼ˆä½¿ç”¨å ä½ç¬¦ï¼Œé¿å… marked.js è§£æï¼‰
    function renderCallout(type, content, customTitle = '') {
      if (!content || !content.trim()) {
        return '';
      }
      
      // è§£æå†…å®¹ä¸º HTML
      let contentHTML = content.trim();
      if (typeof marked !== 'undefined') {
        try {
          contentHTML = marked.parse(content.trim());
        } catch (e) {
          console.warn('Failed to parse callout content:', e);
          contentHTML = content.trim().replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
      }
      
      // è·å–æ ‡é¢˜ï¼ˆè‡ªå®šä¹‰æ ‡é¢˜ä¼˜å…ˆï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤æ ‡é¢˜ï¼‰
      const title = customTitle || getCalloutTitle(type);
      
      // ç”Ÿæˆå ä½ç¬¦
      const placeholder = `<!-- CALLOUT_PLACEHOLDER_${calloutCounter} -->`;
      calloutStore.push({
        type,
        title,
        content: contentHTML
      });
      calloutCounter++;
      
      return placeholder;
    }
    
    // æ›¿æ¢å ä½ç¬¦ä¸ºå®é™… HTML
    function replaceCalloutPlaceholders(html) {
      let result = html;
      calloutStore.forEach((callout, index) => {
        const placeholder = `<!-- CALLOUT_PLACEHOLDER_${index} -->`;
        const calloutHTML = `\n<div class="markdown-callout markdown-callout-${callout.type}">\n<div class="markdown-callout-header">\n<span class="markdown-callout-icon"></span>\n<span class="markdown-callout-title">${callout.title}</span>\n</div>\n<div class="markdown-callout-content">${callout.content}</div>\n</div>\n`;
        result = result.replace(placeholder, calloutHTML);
      });
      // æ¸…ç©ºå­˜å‚¨ï¼Œå‡†å¤‡ä¸‹æ¬¡ä½¿ç”¨
      calloutStore.length = 0;
      calloutCounter = 0;
      return result;
    }
    
    // è·å– callout é»˜è®¤æ ‡é¢˜
    function getCalloutTitle(type) {
      const titles = {
        note: 'Note',
        tip: 'Tip',
        important: 'Important',
        warning: 'Warning',
        caution: 'Caution'
      };
      return titles[type] || 'Note';
    }
    
    // é…ç½® marked.js
    if (typeof marked !== 'undefined') {
      marked.setOptions({
        breaks: true,
        gfm: true,
        html: true
      });
    }

    // åŠ è½½å¹¶æ¸²æŸ“ markdown æ–‡ä»¶
    async function loadMarkdownContent(stepIndex) {
      const contentDiv = stepContents[stepIndex];
      const markdownFile = markdownFiles[stepIndex];
      
      if (!markdownFile) {
        return Promise.resolve();
      }
      
      // å¦‚æœå·²ç»åŠ è½½è¿‡ï¼Œç›´æ¥è¿”å›
      if (contentDiv.dataset.loaded === 'true') {
        return Promise.resolve();
      }

      try {
        const response = await fetch(markdownFile);
        if (!response.ok) {
          throw new Error(`Failed to load ${markdownFile}: ${response.status} ${response.statusText}`);
        }
        
        const markdownText = await response.text();
        const { metadata, content: markdownContent } = parseFrontMatter(markdownText);
        
        // å­˜å‚¨æ­¥éª¤å…ƒæ•°æ®
        // ä¼˜å…ˆçº§ï¼šfront-matter > tutorial-config.json > é»˜è®¤å€¼
        // front-matter å¯ä»¥åªåŒ…å« titleï¼Œå…¶ä»–å­—æ®µä»é…ç½®æ–‡ä»¶è¯»å–
        if (metadata) {
          // åˆå¹¶å…ƒæ•°æ®ï¼šfront-matter ä¸­çš„å­—æ®µä¼˜å…ˆï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å€¼
          stepMetadata[stepIndex] = {
            title: metadata.title || stepMetadata[stepIndex]?.title || `æ­¥éª¤ ${stepIndex + 1}`,
            shortTitle: metadata.shortTitle || metadata.title || stepMetadata[stepIndex]?.shortTitle || stepMetadata[stepIndex]?.title || `æ­¥éª¤ ${stepIndex + 1}`,
            icon: metadata.icon || stepMetadata[stepIndex]?.icon || 'fa-circle',
            order: metadata.order ? parseInt(metadata.order) : (stepMetadata[stepIndex]?.order || stepIndex + 1)
          };
        } else if (!stepMetadata[stepIndex]) {
          // å¦‚æœæ²¡æœ‰ front-matter ä¸”é…ç½®æ–‡ä»¶ä¸­ä¹Ÿæ²¡æœ‰ï¼Œä½¿ç”¨é»˜è®¤å€¼
          stepMetadata[stepIndex] = {
            title: `æ­¥éª¤ ${stepIndex + 1}`,
            shortTitle: `æ­¥éª¤ ${stepIndex + 1}`,
            icon: 'fa-circle',
            order: stepIndex + 1
          };
        }
        
        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åŠ è½½ï¼Œæ›´æ–°å¯¼èˆª
        if (stepMetadata.length === markdownFiles.length && stepMetadata.every(m => m)) {
          totalSteps = stepMetadata.length;
          generateSidebarNav();
          generateStepIndicators();
          attachNavEventListeners();
        }
        
        if (contentDiv.dataset.loaded === 'true') {
          return;
        }
        
        if (typeof marked !== 'undefined') {
          // é¢„å¤„ç† callout è¯­æ³•ï¼ˆåœ¨ marked.parse ä¹‹å‰ï¼‰
          const processedContent = preprocessCallouts(markdownContent);
          // è§£æ Markdown
          let html = marked.parse(processedContent);
          // æ›¿æ¢ callout å ä½ç¬¦ä¸ºå®é™… HTML
          html = replaceCalloutPlaceholders(html);
          contentDiv.innerHTML = html;
          
          // callout å†…å®¹å·²åœ¨ renderCallout ä¸­è§£æï¼Œæ— éœ€å†æ¬¡å¤„ç†
          
          // ä¸ºæ ‡é¢˜æ·»åŠ  IDï¼Œç”¨äºç›®å½•é”šç‚¹
          const headings = contentDiv.querySelectorAll('h1, h2, h3, h4, h5, h6');
          headings.forEach((heading, index) => {
            if (!heading.id) {
              const text = heading.textContent.trim();
              const id = `heading-${stepIndex}-${index}-${text.toLowerCase().replace(/\s+/g, '-').replace(/[^\w\u4e00-\u9fa5-]/g, '')}`;
              heading.id = id;
            }
          });
          
          // æ·»åŠ æ ·å¼ç±»åˆ°æ¸²æŸ“çš„å†…å®¹
          const highlightBlocks = contentDiv.querySelectorAll('blockquote');
          highlightBlocks.forEach(block => {
            if (block.textContent.includes('æç¤º') || block.textContent.includes('å®‰å…¨æç¤º') || block.textContent.includes('å®Œæˆ')) {
              block.classList.add('tutorial-highlight');
            }
          });

          const codeBlocks = contentDiv.querySelectorAll('pre');
          codeBlocks.forEach(pre => {
            pre.classList.add('tutorial-code-block');
          });

          const lists = contentDiv.querySelectorAll('ul, ol');
          lists.forEach(list => {
            list.classList.add('tutorial-list');
          });
          
          contentDiv.dataset.loaded = 'true';
          
          // å¦‚æœå½“å‰æ­¥éª¤æ˜¯æ¿€æ´»çš„ï¼Œæ›´æ–°ç›®å½•
          // ä½¿ç”¨ setTimeout ç¡®ä¿ DOM å®Œå…¨æ¸²æŸ“åå†ç”Ÿæˆç›®å½•
          if (contentDiv.classList.contains('active')) {
            setTimeout(() => {
              updateTOC(stepIndex);
            }, 100);
          }
        } else {
          contentDiv.innerHTML = '<p>Markdown è§£æå™¨æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚</p>';
        }
      } catch (error) {
        console.error('Error loading markdown:', error);
        contentDiv.innerHTML = `<p>åŠ è½½å†…å®¹å¤±è´¥ï¼š${error.message}</p><p>è¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œæˆ–æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯ã€‚</p>`;
      }
    }

    // åŠ è½½æ‰€æœ‰ markdown å†…å®¹
    async function loadAllMarkdown() {
      if (!tutorialConfig) {
        await loadTutorialConfig();
      }
      
      if (!tutorialConfig) {
        return;
      }
      
      // å…ˆåŠ è½½æ‰€æœ‰æ–‡ä»¶ä»¥è·å–å…ƒæ•°æ®ï¼ˆå¦‚æœ Markdown æ–‡ä»¶ä¸­æœ‰ front-matterï¼Œä¼šè¦†ç›–é…ç½®ï¼‰
      for (let i = 0; i < markdownFiles.length; i++) {
        await loadMarkdownContent(i);
      }
      
      // ç¡®ä¿æ‰€æœ‰æ­¥éª¤éƒ½å·²åŠ è½½å…ƒæ•°æ®åå†åŠ è½½å†…å®¹
      totalSteps = stepMetadata.length;
      for (let i = 0; i < totalSteps; i++) {
        await loadMarkdownContent(i);
      }
    }

    // ç»‘å®šå¯¼èˆªäº‹ä»¶ç›‘å¬å™¨
    function attachNavEventListeners() {
      // é‡æ–°è·å–å…ƒç´ å¼•ç”¨
      sidebarItems = document.querySelectorAll('.tutorial-sidebar-nav-item');
      stepIndicators = document.querySelectorAll('.tutorial-step');
      
      // ä¾§è¾¹æ å¯¼èˆª
      sidebarItems.forEach((item, index) => {
        item.addEventListener('click', () => {
          updateStep(index);
          // ç§»åŠ¨ç«¯ç‚¹å‡»åå…³é—­èœå•
          if (window.innerWidth <= 768 && sidebar) {
            sidebar.classList.remove('open');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            if (sidebarOverlay) {
              sidebarOverlay.classList.remove('show');
            }
          }
        });
      });

      // æ­¥éª¤æŒ‡ç¤ºå™¨å¯¼èˆª
      stepIndicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
          updateStep(index);
        });
      });
    }

    // ç”Ÿæˆå¹¶æ›´æ–°ç›®å½•
    function updateTOC(stepIndex) {
      const tocNav = document.getElementById('tutorial-toc-nav');
      if (!tocNav) return;
      
      const activeContent = stepContents[stepIndex];
      
      if (!activeContent) {
        tocNav.innerHTML = '<div class="tutorial-toc-loading">æ­£åœ¨ç”Ÿæˆç›®å½•...</div>';
        return;
      }
      
      // å¦‚æœå†…å®¹è¿˜æœªåŠ è½½ï¼Œç­‰å¾…åŠ è½½å®Œæˆåå†ç”Ÿæˆ
      if (activeContent.dataset.loaded !== 'true') {
        tocNav.innerHTML = '<div class="tutorial-toc-loading">æ­£åœ¨åŠ è½½å†…å®¹...</div>';
        // ç­‰å¾…å†…å®¹åŠ è½½åå†æ¬¡å°è¯•
        const checkInterval = setInterval(() => {
          if (activeContent.dataset.loaded === 'true') {
            clearInterval(checkInterval);
            updateTOC(stepIndex);
          }
        }, 100);
        // æœ€å¤šç­‰å¾… 5 ç§’
        setTimeout(() => clearInterval(checkInterval), 5000);
        return;
      }

      const headings = activeContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
      
      if (headings.length === 0) {
        tocNav.innerHTML = '<div class="tutorial-toc-loading">æš‚æ— ç›®å½•</div>';
        return;
      }

      let tocHTML = '<ul>';
      let stack = []; // ç”¨äºè·Ÿè¸ªåµŒå¥—çº§åˆ«
      
      headings.forEach((heading) => {
        const level = parseInt(heading.tagName.substring(1));
        const id = heading.id || `heading-${stepIndex}-${Math.random().toString(36).substr(2, 9)}`;
        heading.id = id;
        const text = heading.textContent.trim();
        
        // å…³é—­ä¹‹å‰çš„åµŒå¥—çº§åˆ«
        while (stack.length > 0 && stack[stack.length - 1] >= level) {
          tocHTML += '</ul></li>';
          stack.pop();
        }
        
        // å¼€å§‹æ–°çš„åˆ—è¡¨é¡¹
        tocHTML += '<li><a href="#' + id + '">' + text + '</a>';
        
        // å¦‚æœæœ‰å­æ ‡é¢˜ï¼Œå¼€å§‹åµŒå¥—åˆ—è¡¨
        if (level < 6) {
          tocHTML += '<ul>';
          stack.push(level);
        } else {
          tocHTML += '</li>';
        }
      });
      
      // å…³é—­æ‰€æœ‰æœªå…³é—­çš„æ ‡ç­¾
      while (stack.length > 0) {
        tocHTML += '</ul></li>';
        stack.pop();
      }
      
      tocHTML += '</ul>';
      tocNav.innerHTML = tocHTML;

      // æ·»åŠ å¹³æ»‘æ»šåŠ¨
      tocNav.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = link.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            tocNav.querySelectorAll('a').forEach(a => a.classList.remove('active'));
            link.classList.add('active');
          }
        });
      });

      // ç›‘å¬æ»šåŠ¨ï¼Œé«˜äº®å½“å‰ç« èŠ‚
      const tutorialMain = document.querySelector('.tutorial-main');
      if (tutorialMain) {
        // æ¸…ç†ä¹‹å‰çš„ observer
        if (window.tocObserver) {
          window.tocObserver.disconnect();
        }
        
        window.tocObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const id = entry.target.id;
              if (id) {
                tocNav.querySelectorAll('a').forEach(a => {
                  a.classList.remove('active');
                  if (a.getAttribute('href') === '#' + id) {
                    a.classList.add('active');
                  }
                });
              }
            }
          });
        }, {
          root: tutorialMain,
          rootMargin: '-100px 0px -60% 0px',
          threshold: 0
        });

        headings.forEach(heading => {
          window.tocObserver.observe(heading);
        });
      }
    }

    function updateStep(step) {
      if (step < 0 || step >= totalSteps) {
        return;
      }

      currentStep = step;

      // æ›´æ–°å†…å®¹æ˜¾ç¤º
      stepContents.forEach((content, index) => {
        content.classList.toggle('active', index === step);
      });
      
      // å¦‚æœå½“å‰æ­¥éª¤å†…å®¹å·²åŠ è½½ï¼Œç«‹å³æ›´æ–°ç›®å½•
      const activeContent = stepContents[step];
      if (activeContent && activeContent.dataset.loaded === 'true') {
        setTimeout(() => {
          updateTOC(step);
        }, 100);
      }

      // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
      if (stepIndicators.length > 0) {
        stepIndicators.forEach((indicator, index) => {
          indicator.classList.remove('active', 'completed');
          if (index < step) {
            indicator.classList.add('completed');
          } else if (index === step) {
            indicator.classList.add('active');
          }
        });
      }

      // æ›´æ–°ä¾§è¾¹æ 
      if (sidebarItems.length > 0) {
        sidebarItems.forEach((item, index) => {
          item.classList.toggle('active', index === step);
        });
      }

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      const prevBtnElement = document.getElementById('prev-btn');
      const nextBtnElement = document.getElementById('next-btn');
      
      if (prevBtnElement) prevBtnElement.disabled = step === 0;
      if (nextBtnElement) {
        nextBtnElement.innerHTML = step === totalSteps - 1 
          ? 'å®Œæˆ <i class="fas fa-check"></i>' 
          : 'ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>';
      }

      // åŠ è½½å½“å‰æ­¥éª¤çš„å†…å®¹
      loadMarkdownContent(step).then(() => {
        // å†…å®¹åŠ è½½å®Œæˆåï¼Œç¡®ä¿ç›®å½•å·²æ›´æ–°
        if (stepContents[step] && stepContents[step].dataset.loaded === 'true') {
          setTimeout(() => {
            updateTOC(step);
          }, 150);
        }
      });
    }

    // ç»‘å®šæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨ï¼ˆæŒ‰é’®æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œéœ€è¦å»¶è¿Ÿç»‘å®šï¼‰
    function bindButtonEvents() {
      const prevBtnElement = document.getElementById('prev-btn');
      const nextBtnElement = document.getElementById('next-btn');
      
      if (prevBtnElement) {
        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé€šè¿‡å…‹éš†èŠ‚ç‚¹ï¼‰
        const newPrevBtn = prevBtnElement.cloneNode(true);
        prevBtnElement.parentNode.replaceChild(newPrevBtn, prevBtnElement);
        newPrevBtn.addEventListener('click', () => {
          if (currentStep > 0) {
            updateStep(currentStep - 1);
          }
        });
      }

      if (nextBtnElement) {
        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé€šè¿‡å…‹éš†èŠ‚ç‚¹ï¼‰
        const newNextBtn = nextBtnElement.cloneNode(true);
        nextBtnElement.parentNode.replaceChild(newNextBtn, nextBtnElement);
        newNextBtn.addEventListener('click', () => {
          if (currentStep < totalSteps - 1) {
            updateStep(currentStep + 1);
          } else {
            // å®Œæˆæ•™ç¨‹ï¼Œè¿”å›é¦–é¡µ
            window.location.href = 'index.html';
          }
        });
      }
    }

    // å›åˆ°é¡¶éƒ¨æŒ‰é’®
    const backToTopBtn = document.getElementById('back-to-top');
    
    if (backToTopBtn) {
      // ç›‘å¬æ»šåŠ¨ï¼Œæ˜¾ç¤º/éšè—æŒ‰é’®
      const handleScroll = () => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
        if (scrollTop > 300) {
          backToTopBtn.classList.add('show');
        } else {
          backToTopBtn.classList.remove('show');
        }
      };
      
      // ç›‘å¬çª—å£æ»šåŠ¨
      window.addEventListener('scroll', handleScroll);
      
      // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ä¸€æ¬¡
      handleScroll();
      
      // ç‚¹å‡»å›åˆ°é¡¶éƒ¨
      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }

    // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const sidebar = document.querySelector('.tutorial-sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    
    if (mobileMenuToggle && sidebar) {
      const toggleSidebar = () => {
        sidebar.classList.toggle('open');
        if (sidebarOverlay) {
          sidebarOverlay.classList.toggle('show');
        }
      };

      mobileMenuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleSidebar();
      });

      // ç‚¹å‡»é®ç½©å±‚å…³é—­ä¾§è¾¹æ 
      if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', () => {
          if (window.innerWidth <= 768) {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('show');
          }
        });
      }

      // ç‚¹å‡»ä¾§è¾¹æ å¤–éƒ¨æ—¶å…³é—­ä¾§è¾¹æ ï¼ˆç§»åŠ¨ç«¯ï¼‰
      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 768) {
          if (sidebar.classList.contains('open')) {
            if (!sidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
              sidebar.classList.remove('open');
              if (sidebarOverlay) {
                sidebarOverlay.classList.remove('show');
              }
            }
          }
        }
      });

      // ç‚¹å‡»ä¾§è¾¹æ å¯¼èˆªé¡¹åå…³é—­èœå•ï¼ˆç§»åŠ¨ç«¯ï¼‰
      if (sidebarItems && sidebarItems.length > 0) {
        sidebarItems.forEach(item => {
          item.addEventListener('click', () => {
            if (window.innerWidth <= 768) {
              sidebar.classList.remove('open');
              if (sidebarOverlay) {
                sidebarOverlay.classList.remove('show');
              }
            }
          });
        });
      }

      // çª—å£å¤§å°æ”¹å˜æ—¶ï¼Œå¦‚æœåˆ‡æ¢åˆ°æ¡Œé¢ç«¯ï¼Œå…³é—­ç§»åŠ¨ç«¯èœå•
      window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
          sidebar.classList.remove('open');
          if (sidebarOverlay) {
            sidebarOverlay.classList.remove('show');
          }
        }
      });
    }

    // é¡µé¢åŠ è½½æ—¶å…ˆåŠ è½½é…ç½®ï¼Œç„¶ååŠ è½½æ‰€æœ‰ markdown å†…å®¹
    // ç¡®ä¿ marked.js å’Œ DOM éƒ½å·²åŠ è½½
    async function initializeTutorial() {
      try {
        // å…ˆåŠ è½½é…ç½®æ–‡ä»¶
        await loadTutorialConfig();
        
        if (!tutorialConfig || stepMetadata.length === 0) {
          console.error('é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥æˆ–æ­¥éª¤å…ƒæ•°æ®ä¸ºç©º');
          if (tutorialContent) {
            tutorialContent.innerHTML = `<div class="tutorial-header"><h1>picx-images-hosting éƒ¨ç½²æ•™ç¨‹</h1></div><p>é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥æˆ–æ­¥éª¤å…ƒæ•°æ®ä¸ºç©ºã€‚è¯·æ£€æŸ¥æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯ã€‚</p>`;
          }
          return;
        }
        
        console.log('é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸï¼Œæ­¥éª¤æ•°é‡:', stepMetadata.length);
        
        // ç”Ÿæˆå¯¼èˆªï¼ˆç¡®ä¿ stepMetadata å·²å¡«å……ï¼‰
        if (stepMetadata.length > 0) {
          generateSidebarNav();
          generateStepIndicators();
          attachNavEventListeners();
        }
        
        // ç­‰å¾… marked.js åŠ è½½
        if (typeof marked !== 'undefined') {
          await loadAllMarkdown();
        } else {
          // å¦‚æœ marked.js è¿˜æ²¡åŠ è½½ï¼Œç­‰å¾…ä¸€ä¸‹
          setTimeout(async () => {
            if (typeof marked !== 'undefined') {
              await loadAllMarkdown();
            } else {
              console.error('marked.js æœªåŠ è½½');
              if (stepContents.length > 0) {
                stepContents.forEach(content => {
                  if (content) {
                    content.innerHTML = '<p>Markdown è§£æå™¨åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚</p>';
                  }
                });
              }
            }
          }, 500);
        }
      } catch (error) {
        console.error('åˆå§‹åŒ–æ•™ç¨‹å¤±è´¥:', error);
        if (tutorialContent) {
          tutorialContent.innerHTML = `<div class="tutorial-header"><h1>picx-images-hosting éƒ¨ç½²æ•™ç¨‹</h1></div><p>åˆå§‹åŒ–å¤±è´¥ï¼š${error.message}</p>`;
        }
      }
    }

    // ç¡®ä¿æ‰€æœ‰å…ƒç´ éƒ½å·²åŠ è½½
    function startInitialization() {
      console.log('å¼€å§‹åˆå§‹åŒ–æ•™ç¨‹...');
      console.log('tutorialContent:', tutorialContent);
      console.log('sidebarNav:', sidebarNav);
      console.log('stepsContainer:', stepsContainer);
      
      if (!tutorialContent || !sidebarNav || !stepsContainer) {
        console.error('å¿…è¦çš„DOMå…ƒç´ æœªæ‰¾åˆ°');
        setTimeout(startInitialization, 100);
        return;
      }
      
      initializeTutorial();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', startInitialization);
    } else {
      // DOM å·²åŠ è½½ï¼Œä½†å¯èƒ½éœ€è¦ç­‰å¾…ä¸€ä¸‹ç¡®ä¿æ‰€æœ‰å…ƒç´ éƒ½å‡†å¤‡å¥½
      setTimeout(startInitialization, 100);
    }
  </script>
</body>
</html>


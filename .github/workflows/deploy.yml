- name: Generate index.html files
  run: |
    echo "Generating index.html files for directories"
    find . -type d -not -path '*/.git/*' -exec bash -c '
      DIR="{}"
      if [ "$(ls -A "$DIR")" ]; then
        INDEX="$DIR/index.html"
        echo "<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"UTF-8\"><title>Index of $DIR</title></head><body>" > "$INDEX"

        echo "<h1>Index of $DIR</h1>" >> "$INDEX"
        echo "<ul>" >> "$INDEX"

        # 列出文件和目录（不显示 index.html 自己）
        for file in "$DIR"/*; do
          base=$(basename "$file")
          if [ -f "$file" ] && [ "$base" != "index.html" ]; then
            echo "<li><a href=\"$base\">$base</a></li>" >> "$INDEX"
          elif [ -d "$file" ]; then
            echo "<li><a href=\"$base/\">$base/</a></li>" >> "$INDEX"
          fi
        done

        echo "</ul>" >> "$INDEX"

        # 底部追加 index.html + go up
        echo "<hr>" >> "$INDEX"
        echo "<div style=\"margin-top:20px;\">" >> "$INDEX"
        echo "<a href=\"index.html\">index.html</a><br>" >> "$INDEX"

        if [ "$DIR" != "." ]; then
          echo "<a href=\"../\">.. (Go Up)</a>" >> "$INDEX"
        fi

        echo "</div></body></html>" >> "$INDEX"
      fi
    ' \;

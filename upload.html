<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸Šä¼ ç®¡ç† - picx-images-hosting</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./style.css" />
  <style>
    .upload-page {
      min-height: 100vh;
      background: #f6f8fa;
    }

    .upload-header {
      background: #fff;
      border-bottom: 1px solid #d0d7de;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .upload-header h1 {
      margin: 0;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .upload-header .back-link {
      color: #0969da;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .upload-header .back-link:hover {
      text-decoration: underline;
    }

    .upload-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }

    .upload-toolbar {
      background: #fff;
      border: 1px solid #d0d7de;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .upload-toolbar button {
      padding: 8px 16px;
      border: 1px solid #d0d7de;
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .upload-toolbar button:hover {
      background: #f6f8fa;
    }

    .upload-toolbar .btn-primary {
      background: #0969da;
      color: #fff;
      border-color: #0969da;
    }

    .upload-toolbar .btn-primary:hover {
      background: #0860ca;
    }

    .breadcrumb {
      background: #fff;
      border: 1px solid #d0d7de;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .breadcrumb-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .breadcrumb-item a {
      color: #0969da;
      text-decoration: none;
    }

    .breadcrumb-item a:hover {
      text-decoration: underline;
    }

    .breadcrumb-separator {
      color: #8b949e;
    }

    .file-browser {
      background: #fff;
      border: 1px solid #d0d7de;
      border-radius: 8px;
      overflow: hidden;
    }

    .file-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .file-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid #f6f8fa;
      cursor: pointer;
    }

    .file-item:hover {
      background: #f6f8fa;
    }

    .file-item.selected {
      background: #e7f3ff;
    }

    .file-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8b949e;
    }

    .file-name {
      flex: 1;
      font-size: 0.95rem;
    }

    .file-actions {
      display: flex;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .file-item:hover .file-actions {
      opacity: 1;
    }

    .file-actions button {
      padding: 4px 8px;
      border: 1px solid #d0d7de;
      background: #fff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .file-actions button:hover {
      background: #f6f8fa;
    }

    .file-actions .btn-danger {
      color: #cf222e;
      border-color: #e6b0b0;
    }

    .file-actions .btn-danger:hover {
      background: #fff3f3;
    }

    .upload-area {
      border: 2px dashed #d0d7de;
      border-radius: 8px;
      padding: 48px;
      text-align: center;
      background: #fafbfc;
      margin-bottom: 16px;
      transition: all 0.2s;
    }

    .upload-area.dragover {
      border-color: #0969da;
      background: #e7f3ff;
    }

    .upload-area-icon {
      font-size: 3rem;
      color: #8b949e;
      margin-bottom: 16px;
    }

    .upload-area-text {
      font-size: 1.1rem;
      color: #24292f;
      margin-bottom: 8px;
    }

    .upload-area-hint {
      font-size: 0.9rem;
      color: #57606a;
    }

    .upload-progress {
      margin-top: 16px;
    }

    .progress-item {
      background: #fff;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .progress-bar {
      flex: 1;
      height: 8px;
      background: #f6f8fa;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #0969da;
      transition: width 0.3s;
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 2000;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      min-width: 400px;
      max-width: 90vw;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.25rem;
    }

    .modal-close {
      border: none;
      background: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #8b949e;
    }

    .modal-body {
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .form-group input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      font-size: 0.95rem;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .empty-state {
      text-align: center;
      padding: 48px;
      color: #8b949e;
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 16px;
    }
  </style>
</head>
<body class="upload-page">
  <header class="upload-header">
    <h1>
      <span>ğŸ–¼ï¸</span>
      <span>ä¸Šä¼ ç®¡ç†</span>
    </h1>
    <a href="index.html" class="back-link">
      <i class="fas fa-arrow-left"></i>
      è¿”å›é¦–é¡µ
    </a>
  </header>

  <div class="upload-container">
    <div class="upload-toolbar">
      <button id="create-folder-btn" class="btn-primary">
        <i class="fas fa-folder-plus"></i>
        æ–°å»ºæ–‡ä»¶å¤¹
      </button>
      <button id="upload-files-btn">
        <i class="fas fa-upload"></i>
        ä¸Šä¼ æ–‡ä»¶
      </button>
      <button id="upload-folder-btn">
        <i class="fas fa-folder-open"></i>
        ä¸Šä¼ æ–‡ä»¶å¤¹
      </button>
      <input type="file" id="file-input" multiple style="display: none;" />
      <input type="file" id="folder-input" webkitdirectory multiple style="display: none;" />
    </div>

    <div class="breadcrumb" id="breadcrumb">
      <div class="breadcrumb-item">
        <a href="#" data-path="">æ ¹ç›®å½•</a>
      </div>
    </div>

    <div class="file-browser">
      <ul class="file-list" id="file-list">
        <li class="empty-state">
          <div class="empty-state-icon">ğŸ“</div>
          <div>æ­£åœ¨åŠ è½½...</div>
        </li>
      </ul>
    </div>

    <div class="upload-area" id="upload-area">
      <div class="upload-area-icon">ğŸ“¤</div>
      <div class="upload-area-text">æ‹–æ‹½æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹åˆ°è¿™é‡Œä¸Šä¼ </div>
      <div class="upload-area-hint">æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ </div>
    </div>

    <div class="upload-progress" id="upload-progress" style="display: none;"></div>
  </div>

  <!-- åˆ›å»ºæ–‡ä»¶å¤¹æ¨¡æ€æ¡† -->
  <div class="modal" id="create-folder-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ–°å»ºæ–‡ä»¶å¤¹</h2>
        <button class="modal-close" data-close="create-folder">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>æ–‡ä»¶å¤¹åç§°ï¼š</label>
          <input type="text" id="folder-name-input" placeholder="è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="create-folder">å–æ¶ˆ</button>
        <button class="btn-primary" id="confirm-create-folder">åˆ›å»º</button>
      </div>
    </div>
  </div>

  <!-- é‡å‘½åæ¨¡æ€æ¡† -->
  <div class="modal" id="rename-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>é‡å‘½å</h2>
        <button class="modal-close" data-close="rename">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>æ–°åç§°ï¼š</label>
          <input type="text" id="rename-input" placeholder="è¯·è¾“å…¥æ–°åç§°" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" data-close="rename">å–æ¶ˆ</button>
        <button class="btn-primary" id="confirm-rename">ç¡®å®š</button>
      </div>
    </div>
  </div>

  <script>
    const REPO_OWNER = 'hoochanlon';
    const REPO_NAME = 'picx-images-hosting';
    const BRANCH = 'master';
    const IMAGE_EXT = /\.(jpe?g|png|gif|webp|svg)$/i;

    // è‡ªåŠ¨æ£€æµ‹ API åŸºç¡€åœ°å€
    const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const isVercelDev = isLocalhost && window.location.port === '3000';
    const API_BASE = isLocalhost && !isVercelDev
      ? 'https://picx-images-hosting-brown.vercel.app' 
      : window.location.origin;
    const API_ENDPOINT = `${API_BASE}/api/github`;

    let currentPath = '';
    let files = [];
    let folders = [];

    // DOM å…ƒç´ 
    const fileListEl = document.getElementById('file-list');
    const breadcrumbEl = document.getElementById('breadcrumb');
    const uploadAreaEl = document.getElementById('upload-area');
    const fileInputEl = document.getElementById('file-input');
    const folderInputEl = document.getElementById('folder-input');
    const uploadProgressEl = document.getElementById('upload-progress');
    const createFolderBtn = document.getElementById('create-folder-btn');
    const uploadFilesBtn = document.getElementById('upload-files-btn');
    const uploadFolderBtn = document.getElementById('upload-folder-btn');
    const createFolderModal = document.getElementById('create-folder-modal');
    const renameModal = document.getElementById('rename-modal');
    const folderNameInput = document.getElementById('folder-name-input');
    const renameInput = document.getElementById('rename-input');

    // å·¥å…·å‡½æ•°
    async function toBase64(file) {
      const buffer = await file.arrayBuffer();
      const bytes = new Uint8Array(buffer);
      let binary = '';
      const chunk = 0x8000;
      for (let i = 0; i < bytes.length; i += chunk) {
        binary += String.fromCharCode(...bytes.subarray(i, i + chunk));
      }
      return btoa(binary);
    }

    async function apiRequest(payload) {
      const res = await fetch(API_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(text || `API è¯·æ±‚å¤±è´¥: ${res.status}`);
      }
      return res.json();
    }

    async function fetchTree() {
      const url = `${API_BASE}/api/tree`;
      const res = await fetch(url);
      if (!res.ok) {
        const body = await res.json().catch(() => ({}));
        const hint = body.message || `HTTP ${res.status}`;
        throw new Error(`è·å–ä»“åº“æ ‘å¤±è´¥ï¼š${hint}`);
      }
      return res.json();
    }

    function buildPath(...parts) {
      return parts.filter(p => p).join('/');
    }

    function getParentPath(path) {
      if (!path) return '';
      const parts = path.split('/').filter(p => p);
      parts.pop();
      return parts.join('/');
    }

    function updateBreadcrumb(path) {
      breadcrumbEl.innerHTML = '';
      const parts = path ? path.split('/').filter(p => p) : [];
      
      // æ ¹ç›®å½•
      const rootItem = document.createElement('div');
      rootItem.className = 'breadcrumb-item';
      const rootLink = document.createElement('a');
      rootLink.href = '#';
      rootLink.textContent = 'æ ¹ç›®å½•';
      rootLink.dataset.path = '';
      rootLink.addEventListener('click', (e) => {
        e.preventDefault();
        navigateTo('');
      });
      rootItem.appendChild(rootLink);
      breadcrumbEl.appendChild(rootItem);

      // è·¯å¾„éƒ¨åˆ†
      let currentPath = '';
      parts.forEach((part, index) => {
        const separator = document.createElement('span');
        separator.className = 'breadcrumb-separator';
        separator.textContent = ' / ';
        breadcrumbEl.appendChild(separator);

        currentPath = buildPath(currentPath, part);
        const item = document.createElement('div');
        item.className = 'breadcrumb-item';
        const link = document.createElement('a');
        link.href = '#';
        link.textContent = part;
        link.dataset.path = currentPath;
        link.addEventListener('click', (e) => {
          e.preventDefault();
          navigateTo(currentPath);
        });
        item.appendChild(link);
        breadcrumbEl.appendChild(item);
      });
    }

    function navigateTo(path) {
      currentPath = path;
      updateBreadcrumb(path);
      loadFiles();
    }

    function renderFiles() {
      fileListEl.innerHTML = '';
      
      if (folders.length === 0 && files.length === 0) {
        fileListEl.innerHTML = `
          <li class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <div>å½“å‰ç›®å½•ä¸ºç©º</div>
          </li>
        `;
        return;
      }

      // æ˜¾ç¤ºæ–‡ä»¶å¤¹
      folders.forEach(folder => {
        const li = document.createElement('li');
        li.className = 'file-item';
        li.innerHTML = `
          <div class="file-icon"><i class="fas fa-folder"></i></div>
          <div class="file-name">${folder.name}</div>
          <div class="file-actions">
            <button class="btn-rename" data-type="folder" data-path="${folder.path}" title="é‡å‘½å">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-delete btn-danger" data-type="folder" data-path="${folder.path}" title="åˆ é™¤">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        
        li.querySelector('.file-name').addEventListener('click', () => {
          navigateTo(folder.path);
        });
        
        li.querySelector('.btn-rename').addEventListener('click', (e) => {
          e.stopPropagation();
          showRenameModal('folder', folder.path, folder.name);
        });
        
        li.querySelector('.btn-delete').addEventListener('click', (e) => {
          e.stopPropagation();
          deleteItem('folder', folder.path);
        });
        
        fileListEl.appendChild(li);
      });

      // æ˜¾ç¤ºæ–‡ä»¶
      files.forEach(file => {
        const li = document.createElement('li');
        li.className = 'file-item';
        const isImage = IMAGE_EXT.test(file.name);
        li.innerHTML = `
          <div class="file-icon">
            <i class="fas ${isImage ? 'fa-image' : 'fa-file'}"></i>
          </div>
          <div class="file-name">${file.name}</div>
          <div class="file-actions">
            <button class="btn-rename" data-type="file" data-path="${file.path}" title="é‡å‘½å">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-delete btn-danger" data-type="file" data-path="${file.path}" title="åˆ é™¤">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        
        li.querySelector('.btn-rename').addEventListener('click', (e) => {
          e.stopPropagation();
          showRenameModal('file', file.path, file.name);
        });
        
        li.querySelector('.btn-delete').addEventListener('click', (e) => {
          e.stopPropagation();
          deleteItem('file', file.path);
        });
        
        fileListEl.appendChild(li);
      });
    }

    async function loadFiles() {
      try {
        fileListEl.innerHTML = '<li class="empty-state"><div>æ­£åœ¨åŠ è½½...</div></li>';
        const tree = await fetchTree();
        
        const allItems = (tree.tree || []).filter(item => item.type === 'blob' || item.type === 'tree');
        
        folders = [];
        files = [];
        
        allItems.forEach(item => {
          const itemPath = item.path;
          const itemDir = itemPath.includes('/') ? itemPath.slice(0, itemPath.lastIndexOf('/')) : '';
          
          if (itemDir === currentPath) {
            if (item.type === 'tree') {
              folders.push({
                name: itemPath.split('/').pop(),
                path: itemPath
              });
            } else {
              files.push({
                name: itemPath.split('/').pop(),
                path: itemPath
              });
            }
          }
        });
        
        folders.sort((a, b) => a.name.localeCompare(b.name));
        files.sort((a, b) => a.name.localeCompare(b.name));
        
        renderFiles();
      } catch (err) {
        console.error(err);
        fileListEl.innerHTML = `
          <li class="empty-state">
            <div class="empty-state-icon">âŒ</div>
            <div>åŠ è½½å¤±è´¥ï¼š${err.message}</div>
          </li>
        `;
      }
    }

    async function createFolder(name) {
      if (!name || !name.trim()) {
        alert('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°');
        return;
      }
      
      const folderPath = buildPath(currentPath, name.trim());
      const folderPathWithSlash = folderPath.endsWith('/') ? folderPath : folderPath + '/';
      
      // åˆ›å»º .gitkeep æ–‡ä»¶æ¥åˆ›å»ºæ–‡ä»¶å¤¹
      const content = btoa('');
      try {
        await apiRequest({
          action: 'upload',
          path: `${folderPathWithSlash}.gitkeep`,
          content: content,
          message: `Create folder: ${folderPath}`
        });
        
        // åˆ é™¤ .gitkeep æ–‡ä»¶ï¼ˆGitHub ä¼šè‡ªåŠ¨ä¿ç•™ç©ºæ–‡ä»¶å¤¹ï¼‰
        // å®é™…ä¸Š GitHub ä¸æ”¯æŒç©ºæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿ç•™ .gitkeep
        // æˆ–è€…åˆ›å»ºä¸€ä¸ª README.md
        
        loadFiles();
        closeModal('create-folder');
        folderNameInput.value = '';
      } catch (err) {
        console.error(err);
        alert('åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥ï¼š' + err.message);
      }
    }

    async function uploadFiles(fileList, basePath = '') {
      const targetPath = basePath || currentPath || 'imgs/uploads/kate/';
      const filesArray = Array.from(fileList);
      
      if (filesArray.length === 0) return;
      
      uploadProgressEl.style.display = 'block';
      uploadProgressEl.innerHTML = '';
      
      for (let i = 0; i < filesArray.length; i++) {
        const file = filesArray[i];
        const progressItem = document.createElement('div');
        progressItem.className = 'progress-item';
        progressItem.innerHTML = `
          <div class="file-name">${file.name}</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 0%"></div>
          </div>
          <div class="progress-text">0%</div>
        `;
        uploadProgressEl.appendChild(progressItem);
        
        const progressFill = progressItem.querySelector('.progress-fill');
        const progressText = progressItem.querySelector('.progress-text');
        
        try {
          const content = await toBase64(file);
          const filePath = buildPath(targetPath, file.name);
          
          await apiRequest({
            action: 'upload',
            path: filePath,
            content: content,
            message: `Upload: ${filePath}`
          });
          
          progressFill.style.width = '100%';
          progressText.textContent = 'å®Œæˆ';
          progressItem.style.opacity = '0.6';
        } catch (err) {
          console.error(err);
          progressText.textContent = 'å¤±è´¥ï¼š' + err.message;
          progressItem.style.color = '#cf222e';
        }
      }
      
      setTimeout(() => {
        loadFiles();
        setTimeout(() => {
          uploadProgressEl.style.display = 'none';
          uploadProgressEl.innerHTML = '';
        }, 2000);
      }, 1000);
    }

    function showRenameModal(type, path, currentName) {
      renameInput.value = currentName;
      renameInput.dataset.type = type;
      renameInput.dataset.path = path;
      showModal('rename');
    }

    async function renameItem(type, oldPath, newName) {
      if (!newName || !newName.trim()) {
        alert('è¯·è¾“å…¥æ–°åç§°');
        return;
      }
      
      const parentPath = getParentPath(oldPath);
      const newPath = buildPath(parentPath, newName.trim());
      
      if (type === 'folder') {
        // æ–‡ä»¶å¤¹é‡å‘½åéœ€è¦ç§»åŠ¨æ‰€æœ‰æ–‡ä»¶
        alert('æ–‡ä»¶å¤¹é‡å‘½ååŠŸèƒ½éœ€è¦ç§»åŠ¨æ‰€æœ‰æ–‡ä»¶ï¼Œæ­¤åŠŸèƒ½è¾ƒå¤æ‚ï¼Œå»ºè®®æ‰‹åŠ¨æ“ä½œ');
        return;
      }
      
      try {
        // è·å–åŸæ–‡ä»¶å†…å®¹
        const fileRes = await fetch(`${API_BASE}/api/file?path=${encodeURIComponent(oldPath)}`);
        const fileData = await fileRes.json();
        
        // åˆ›å»ºæ–°æ–‡ä»¶
        await apiRequest({
          action: 'upload',
          path: newPath,
          content: fileData.content,
          message: `Rename: ${oldPath} -> ${newPath}`
        });
        
        // åˆ é™¤åŸæ–‡ä»¶
        await apiRequest({
          action: 'delete',
          path: oldPath,
          sha: fileData.sha,
          message: `Delete old file: ${oldPath}`
        });
        
        loadFiles();
        closeModal('rename');
      } catch (err) {
        console.error(err);
        alert('é‡å‘½åå¤±è´¥ï¼š' + err.message);
      }
    }

    async function deleteItem(type, path) {
      if (!confirm(`ç¡®å®šè¦åˆ é™¤${type === 'folder' ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'} "${path}" å—ï¼Ÿ`)) {
        return;
      }
      
      try {
        if (type === 'file') {
          const fileRes = await fetch(`${API_BASE}/api/file?path=${encodeURIComponent(path)}`);
          const fileData = await fileRes.json();
          
          await apiRequest({
            action: 'delete',
            path: path,
            sha: fileData.sha,
            message: `Delete: ${path}`
          });
        } else {
          alert('æ–‡ä»¶å¤¹åˆ é™¤åŠŸèƒ½éœ€è¦åˆ é™¤æ‰€æœ‰æ–‡ä»¶ï¼Œæ­¤åŠŸèƒ½è¾ƒå¤æ‚ï¼Œå»ºè®®æ‰‹åŠ¨æ“ä½œ');
          return;
        }
        
        loadFiles();
      } catch (err) {
        console.error(err);
        alert('åˆ é™¤å¤±è´¥ï¼š' + err.message);
      }
    }

    function showModal(modalId) {
      document.getElementById(`${modalId}-modal`).classList.add('show');
    }

    function closeModal(modalId) {
      document.getElementById(`${modalId}-modal`).classList.remove('show');
    }

    // äº‹ä»¶ç›‘å¬
    createFolderBtn.addEventListener('click', () => {
      folderNameInput.value = '';
      showModal('create-folder');
    });

    document.getElementById('confirm-create-folder').addEventListener('click', () => {
      createFolder(folderNameInput.value);
    });

    document.getElementById('confirm-rename').addEventListener('click', () => {
      const type = renameInput.dataset.type;
      const path = renameInput.dataset.path;
      renameItem(type, path, renameInput.value);
    });

    uploadFilesBtn.addEventListener('click', () => {
      fileInputEl.click();
    });

    uploadFolderBtn.addEventListener('click', () => {
      folderInputEl.click();
    });

    fileInputEl.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        uploadFiles(e.target.files);
        e.target.value = '';
      }
    });

    folderInputEl.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        uploadFiles(e.target.files, currentPath || 'imgs/uploads/kate/');
        e.target.value = '';
      }
    });

    // æ‹–æ‹½ä¸Šä¼ 
    uploadAreaEl.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadAreaEl.classList.add('dragover');
    });

    uploadAreaEl.addEventListener('dragleave', () => {
      uploadAreaEl.classList.remove('dragover');
    });

    uploadAreaEl.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadAreaEl.classList.remove('dragover');
      
      const files = Array.from(e.dataTransfer.files);
      if (files.length > 0) {
        uploadFiles(files);
      }
    });

    // æ¨¡æ€æ¡†å…³é—­
    document.querySelectorAll('[data-close]').forEach(btn => {
      btn.addEventListener('click', () => {
        const modalId = btn.dataset.close;
        closeModal(modalId);
      });
    });

    // åˆå§‹åŒ–
    loadFiles();
  </script>
</body>
</html>

